---
- name: Kubernetes Setup
  hosts: host2
  become: true
  tasks:
   - name: Swap deaktivieren
     command: swapoff -a

   - name: Swap Eintrag aus /etc/fstab entfernen
     lineinfile:
       dest: /etc/fstab
       regexp: swap
       state: absent

   - name: Abhängigkeiten Kubernetes installieren
     apt:
       name:
         - apt-transport-https
         - ca-certificates
         - curl
         - gnupg-agent
         - vim
         - software-properties-common
       state: present

   - name: Kubernetes GPG Key hinzufügen
     apt_key:
       url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
       state: present

   - name: Kubernetes Repository hinzufügen
     apt_repository:
       repo: deb http://apt.kubernetes.io/ kubernetes-xenial main
       state: present
       filename: kubernetes

   - name: Kubernetes Pakete installieren
     apt:
       name:
         - kubeadm
         - kubectl
         - kubelet
       state: present

   - name: Kubelet dauerhaft aktivieren
     service:
       name: kubelet
       enabled: yes
